<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="builder::transaction"><title>clementine_core::builder::transaction - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../../../static.files/rustdoc-46132b98.css"><meta name="rustdoc-vars" data-root-path="../../../" data-static-root-path="../../../static.files/" data-current-crate="clementine_core" data-themes="" data-resource-suffix="" data-rustdoc-version="1.85.1 (4eb161250 2025-03-15)" data-channel="1.85.1" data-search-js="search-75f5ac3e.js" data-settings-js="settings-0f613d39.js" ><script src="../../../static.files/storage-59e33391.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../../static.files/main-5f194d8c.js"></script><noscript><link rel="stylesheet" href="../../../static.files/noscript-893ab5e7.css"></noscript><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-32x32-6580c154.png"><link rel="icon" type="image/svg+xml" href="../../../static.files/favicon-044be391.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../../clementine_core/index.html">clementine_<wbr>core</a><span class="version">0.3.1</span></h2></div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">Module transaction</a></h2><h3><a href="#">Sections</a></h3><ul class="block top-toc"><li><a href="#buildertransaction" title="builder::transaction">builder::transaction</a><ul><li><a href="#overview" title="Overview">Overview</a></li><li><a href="#main-components" title="Main Components">Main Components</a></li></ul></li></ul><h3><a href="#modules">Module Items</a></h3><ul class="block"><li><a href="#modules" title="Modules">Modules</a></li><li><a href="#structs" title="Structs">Structs</a></li><li><a href="#enums" title="Enums">Enums</a></li><li><a href="#constants" title="Constants">Constants</a></li><li><a href="#traits" title="Traits">Traits</a></li><li><a href="#functions" title="Functions">Functions</a></li><li><a href="#types" title="Type Aliases">Type Aliases</a></li></ul></section><div id="rustdoc-modnav"><h2><a href="../index.html">In clementine_<wbr>core::<wbr>builder</a></h2></div></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><span class="rustdoc-breadcrumbs"><a href="../../index.html">clementine_core</a>::<wbr><a href="../index.html">builder</a></span><h1>Module <span>transaction</span><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../../src/clementine_core/builder/transaction/mod.rs.html#1-775">Source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><h2 id="buildertransaction"><a class="doc-anchor" href="#buildertransaction">Â§</a>builder::transaction</h2>
<p>This module provides the core logic for constructing, handling, and signing the various Bitcoin transactions
required by the Clementine bridge protocol. It defines the creation, and validation of
transaction flows involving operators, verifiers, watchtowers, and the security council, aimed to make it
easy to create transactions and sign them properly.</p>
<h3 id="overview"><a class="doc-anchor" href="#overview">Â§</a>Overview</h3>
<p>The transaction builder is responsible for:</p>
<ul>
<li>Defining all transaction types and their flows in the protocol (see <a href="enum.TransactionType.html" title="enum clementine_core::builder::transaction::TransactionType"><code>TransactionType</code></a>).</li>
<li>Building and signing transactions for deposit, withdrawal, challenge, reimbursement, and related operations.</li>
<li>Storing transaction inputs/outputs, scripts, and Taproot spend information.</li>
<li>Providing utilities to speed up transaction creating during a deposit using caching tx and db data.</li>
</ul>
<h3 id="main-components"><a class="doc-anchor" href="#main-components">Â§</a>Main Components</h3>
<ul>
<li>[<code>mod.rs</code>] - The main entry point, re-exporting key types and functions. Defines some helper functions for creating taproot outputs.</li>
<li>[<code>creator.rs</code>] - Contains the functions to create multiple TxHandlerâ€™s for a deposit and related structs for caching. In particular, it contains the functions to create TxHandlerâ€™s for all transactions generated during a deposit from a single kickoff.</li>
<li>[<code>operator_collateral.rs</code>] - Handles the creation of operator-specific collateral-related transactions, such as round, ready-to-reimburse, and unspent kickoff transactions.</li>
<li>[<code>operator_reimburse.rs</code>] - Implements the creation of reimbursement and payout transactions, including logic for operator compensation and optimistic payouts.</li>
<li>[<code>operator_assert.rs</code>] - Provides functions for creating BitVM assertion and timeout transactions.</li>
<li>[<code>challenge.rs</code>] - Handles the creation of challenge, disprove, and watchtower challenge transactions, supporting protocol dispute resolution and fraud proofs.</li>
<li>[<code>sign.rs</code>] - Contains logic for signing transactions using data in the <a href="struct.TxHandler.html" title="struct clementine_core::builder::transaction::TxHandler"><code>TxHandler</code></a>.</li>
<li>[<code>txhandler.rs</code>] - Defines the <a href="struct.TxHandler.html" title="struct clementine_core::builder::transaction::TxHandler"><code>TxHandler</code></a> abstraction, which wraps a transaction and its metadata, and provides methods for signing, finalizing, and extracting transaction data.</li>
<li>[<code>input.rs</code>] - Defines types and utilities for transaction inputs used in the <a href="struct.TxHandler.html" title="struct clementine_core::builder::transaction::TxHandler"><code>TxHandler</code></a>.</li>
<li>[<code>output.rs</code>] - Defines types and utilities for transaction outputs used in the <a href="struct.TxHandler.html" title="struct clementine_core::builder::transaction::TxHandler"><code>TxHandler</code></a>.</li>
<li>[<code>deposit_signature_owner.rs</code>] - Maps which TxIn signatures are signed by which protocol entities, additionally supporting different Sighash types.</li>
</ul>
</div></details><h2 id="modules" class="section-header">Modules<a href="#modules" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="mod" href="challenge/index.html" title="mod clementine_core::builder::transaction::challenge">challenge</a></div><div class="desc docblock-short">Challenge Transaction Logic</div></li><li><div class="item-name"><a class="mod" href="creator/index.html" title="mod clementine_core::builder::transaction::creator">creator</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Transaction Handler Creation Logic</div></li><li><div class="item-name"><a class="mod" href="deposit_signature_owner/index.html" title="mod clementine_core::builder::transaction::deposit_signature_owner">deposit_<wbr>signature_<wbr>owner</a></div><div class="desc docblock-short">Deposit Signature Ownership Mapping</div></li><li><div class="item-name"><a class="mod" href="input/index.html" title="mod clementine_core::builder::transaction::input">input</a></div><div class="desc docblock-short">Transaction Input Types and Utilities</div></li><li><div class="item-name"><a class="mod" href="operator_assert/index.html" title="mod clementine_core::builder::transaction::operator_assert">operator_<wbr>assert</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">This module contains the creation of BitVM operator assertion transactions and timeout transactions related to assertions.</div></li><li><div class="item-name"><a class="mod" href="operator_collateral/index.html" title="mod clementine_core::builder::transaction::operator_collateral">operator_<wbr>collateral</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Collaterals</div></li><li><div class="item-name"><a class="mod" href="operator_reimburse/index.html" title="mod clementine_core::builder::transaction::operator_reimburse">operator_<wbr>reimburse</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Operator Reimburse Transactions</div></li><li><div class="item-name"><a class="mod" href="output/index.html" title="mod clementine_core::builder::transaction::output">output</a></div><div class="desc docblock-short">Transaction Output Types and Utilities</div></li><li><div class="item-name"><a class="mod" href="sign/index.html" title="mod clementine_core::builder::transaction::sign">sign</a></div><div class="desc docblock-short">Transaction Signing Utilities</div></li><li><div class="item-name"><a class="mod" href="txhandler/index.html" title="mod clementine_core::builder::transaction::txhandler">txhandler</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Transaction Handler Module</div></li></ul><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.ContractContext.html" title="struct clementine_core::builder::transaction::ContractContext">Contract<wbr>Context</a></div><div class="desc docblock-short">Context for a single operator and round, and optionally a single deposit.
Data about deposit and kickoff idx is needed to create the deposit-related transactions.
For non deposit related transactions, like the round tx and ready to reimburse tx, the round idx is enough.</div></li><li><div class="item-name"><a class="struct" href="struct.KickoffWinternitzKeys.html" title="struct clementine_core::builder::transaction::KickoffWinternitzKeys">Kickoff<wbr>Winternitz<wbr>Keys</a></div><div class="desc docblock-short">Helper struct to get specific kickoff winternitz keys for a sequential collateral tx</div></li><li><div class="item-name"><a class="struct" href="struct.ReimburseDbCache.html" title="struct clementine_core::builder::transaction::ReimburseDbCache">Reimburse<wbr>DbCache</a></div><div class="desc docblock-short">Struct to retrieve and cache data from DB for creating TxHandlers on demand
It can only store information for one deposit and operator pair.
It has two context modes, for rounds or for deposits. Deposit context needs additional information, like the deposit outpoint, which is not needed for rounds.
Round context can only create transactions that do not depend on the deposit, like the round tx and ready to reimburse tx.
Deposit context can create all transactions.
Note: This cache is specific to a single operator, for each operator a new cache is needed.</div></li><li><div class="item-name"><a class="struct" href="struct.Signed.html" title="struct clementine_core::builder::transaction::Signed">Signed</a></div><div class="desc docblock-short">Marker type for signed transactions.</div></li><li><div class="item-name"><a class="struct" href="struct.TxHandler.html" title="struct clementine_core::builder::transaction::TxHandler">TxHandler</a></div><div class="desc docblock-short">Handler for protocol transactions, wrapping inputs, outputs, and cached transaction data.</div></li><li><div class="item-name"><a class="struct" href="struct.TxHandlerBuilder.html" title="struct clementine_core::builder::transaction::TxHandlerBuilder">TxHandler<wbr>Builder</a></div><div class="desc docblock-short">Builder for <a href="struct.TxHandler.html" title="struct clementine_core::builder::transaction::TxHandler"><code>TxHandler</code></a>, allowing stepwise construction of inputs and outputs.</div></li><li><div class="item-name"><a class="struct" href="struct.TxHandlerCache.html" title="struct clementine_core::builder::transaction::TxHandlerCache">TxHandler<wbr>Cache</a></div><div class="desc docblock-short">Stores and manages cached transaction handlers for efficient flow construction.</div></li><li><div class="item-name"><a class="struct" href="struct.Unsigned.html" title="struct clementine_core::builder::transaction::Unsigned">Unsigned</a></div><div class="desc docblock-short">Marker type for unsigned transactions.</div></li></ul><h2 id="enums" class="section-header">Enums<a href="#enums" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="enum" href="enum.TransactionType.html" title="enum clementine_core::builder::transaction::TransactionType">Transaction<wbr>Type</a></div><div class="desc docblock-short">Types of all transactions that can be created. Some transactions have a
(usize) index as there are multiple instances of the same transaction type
per kickoff.</div></li><li><div class="item-name"><a class="enum" href="enum.TxError.html" title="enum clementine_core::builder::transaction::TxError">TxError</a></div></li></ul><h2 id="constants" class="section-header">Constants<a href="#constants" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="constant" href="constant.DEFAULT_SEQUENCE.html" title="constant clementine_core::builder::transaction::DEFAULT_SEQUENCE">DEFAULT_<wbr>SEQUENCE</a></div></li></ul><h2 id="traits" class="section-header">Traits<a href="#traits" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="trait" href="trait.State.html" title="trait clementine_core::builder::transaction::State">State</a></div></li></ul><h2 id="functions" class="section-header">Functions<a href="#functions" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.anchor_output.html" title="fn clementine_core::builder::transaction::anchor_output">anchor_<wbr>output</a></div><div class="desc docblock-short">Creates a P2A (anchor) output for Child Pays For Parent (CPFP) fee bumping.</div></li><li><div class="item-name"><a class="fn" href="fn.combine_emergency_stop_txhandler.html" title="fn clementine_core::builder::transaction::combine_emergency_stop_txhandler">combine_<wbr>emergency_<wbr>stop_<wbr>txhandler</a></div><div class="desc docblock-short">Combines multiple emergency stop transactions into a single transaction.</div></li><li><div class="item-name"><a class="fn" href="fn.create_burn_unused_kickoff_connectors_txhandler.html" title="fn clementine_core::builder::transaction::create_burn_unused_kickoff_connectors_txhandler">create_<wbr>burn_<wbr>unused_<wbr>kickoff_<wbr>connectors_<wbr>txhandler</a></div><div class="desc docblock-short">Creates a <a href="struct.TxHandler.html" title="struct clementine_core::builder::transaction::TxHandler"><code>TxHandler</code></a> for burning unused kickoff connectors.</div></li><li><div class="item-name"><a class="fn" href="fn.create_disprove_taproot_output.html" title="fn clementine_core::builder::transaction::create_disprove_taproot_output">create_<wbr>disprove_<wbr>taproot_<wbr>output</a></div><div class="desc docblock-short">Creates a Taproot output for a disprove path, combining a script, an additional disprove script, and a hidden node containing the BitVM disprove scripts.</div></li><li><div class="item-name"><a class="fn" href="fn.create_emergency_stop_txhandler.html" title="fn clementine_core::builder::transaction::create_emergency_stop_txhandler">create_<wbr>emergency_<wbr>stop_<wbr>txhandler</a></div><div class="desc docblock-short">Creates a <a href="struct.TxHandler.html" title="struct clementine_core::builder::transaction::TxHandler"><code>TxHandler</code></a> for the <code>emergency_stop_tx</code>.</div></li><li><div class="item-name"><a class="fn" href="fn.create_move_to_vault_txhandler.html" title="fn clementine_core::builder::transaction::create_move_to_vault_txhandler">create_<wbr>move_<wbr>to_<wbr>vault_<wbr>txhandler</a></div><div class="desc docblock-short">Creates a <a href="struct.TxHandler.html" title="struct clementine_core::builder::transaction::TxHandler"><code>TxHandler</code></a> for the <code>move_to_vault_tx</code>.</div></li><li><div class="item-name"><a class="fn" href="fn.create_optimistic_payout_txhandler.html" title="fn clementine_core::builder::transaction::create_optimistic_payout_txhandler">create_<wbr>optimistic_<wbr>payout_<wbr>txhandler</a></div><div class="desc docblock-short">Creates a <a href="struct.TxHandler.html" title="struct clementine_core::builder::transaction::TxHandler"><code>TxHandler</code></a> for the <code>optimistic_payout_tx</code>.</div></li><li><div class="item-name"><a class="fn" href="fn.create_payout_txhandler.html" title="fn clementine_core::builder::transaction::create_payout_txhandler">create_<wbr>payout_<wbr>txhandler</a></div><div class="desc docblock-short">Creates a <a href="struct.TxHandler.html" title="struct clementine_core::builder::transaction::TxHandler"><code>TxHandler</code></a> for the <code>payout_tx</code>.</div></li><li><div class="item-name"><a class="fn" href="fn.create_replacement_deposit_txhandler.html" title="fn clementine_core::builder::transaction::create_replacement_deposit_txhandler">create_<wbr>replacement_<wbr>deposit_<wbr>txhandler</a></div><div class="desc docblock-short">Creates a <a href="struct.TxHandler.html" title="struct clementine_core::builder::transaction::TxHandler"><code>TxHandler</code></a> for the <code>replacement_deposit_tx</code>.</div></li><li><div class="item-name"><a class="fn" href="fn.create_round_nth_txhandler.html" title="fn clementine_core::builder::transaction::create_round_nth_txhandler">create_<wbr>round_<wbr>nth_<wbr>txhandler</a></div><div class="desc docblock-short">Creates the nth (1-indexed) <code>round_txhandler</code> and <code>reimburse_generator_txhandler</code> pair for a specific operator.</div></li><li><div class="item-name"><a class="fn" href="fn.create_round_txhandlers.html" title="fn clementine_core::builder::transaction::create_round_txhandlers">create_<wbr>round_<wbr>txhandlers</a></div><div class="desc docblock-short">Creates the round and ready-to-reimburse txhandlers for a specific operator and round index.
These transactions currently include round tx, ready to reimburse tx, and unspent kickoff txs.</div></li><li><div class="item-name"><a class="fn" href="fn.create_taproot_output_with_hidden_node.html" title="fn clementine_core::builder::transaction::create_taproot_output_with_hidden_node">create_<wbr>taproot_<wbr>output_<wbr>with_<wbr>hidden_<wbr>node</a></div><div class="desc docblock-short">Helper function to create a Taproot output that combines a single script and a root hash containing any number of scripts.
The main use case for this function is to speed up the tx creating during a deposit. We donâ€™t need to create and combine all the
scripts in the taproot repeatedly, but cache and combine the common scripts for each kickoff tx to a root hash, and add an additional script
that depends on the specific operator or nofn_pk that is signing the deposit.</div></li><li><div class="item-name"><a class="fn" href="fn.create_txhandlers.html" title="fn clementine_core::builder::transaction::create_txhandlers">create_<wbr>txhandlers</a></div><div class="desc docblock-short">Creates all required transaction handlers for a given context and transaction type.</div></li><li><div class="item-name"><a class="fn" href="fn.non_ephemeral_anchor_output.html" title="fn clementine_core::builder::transaction::non_ephemeral_anchor_output">non_<wbr>ephemeral_<wbr>anchor_<wbr>output</a></div><div class="desc docblock-short">A non-ephemeral anchor output. It is used in txâ€™s that should have a non-ephemeral anchor.
Because ephemeral anchors force the tx to have 0 fee.</div></li><li><div class="item-name"><a class="fn" href="fn.op_return_txout.html" title="fn clementine_core::builder::transaction::op_return_txout">op_<wbr>return_<wbr>txout</a></div><div class="desc docblock-short">Creates an OP_RETURN output with the given data slice.</div></li><li><div class="item-name"><a class="fn" href="fn.remove_txhandler_from_map.html" title="fn clementine_core::builder::transaction::remove_txhandler_from_map">remove_<wbr>txhandler_<wbr>from_<wbr>map</a></div><div class="desc docblock-short">Removes a <a href="struct.TxHandler.html" title="struct clementine_core::builder::transaction::TxHandler"><code>TxHandler</code></a> from a map by transaction type, returning an error if not found.</div></li></ul><h2 id="types" class="section-header">Type Aliases<a href="#types" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="type" href="type.HiddenNode.html" title="type clementine_core::builder::transaction::HiddenNode">Hidden<wbr>Node</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div></li><li><div class="item-name"><a class="type" href="type.SighashCalculator.html" title="type clementine_core::builder::transaction::SighashCalculator">Sighash<wbr>Calculator</a></div></li></ul></section></div></main></body></html>